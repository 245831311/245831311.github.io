---
title: 流媒体基础知识点
date: 2021-07-26 11:16:39
categories: 
- 视频
tags:
- 视频
---

# 目的

学习流媒体之前，应该要首先知道流媒体相关基础知识点，这样能够更好地掌握流媒体

## 概念
流媒体是什么？按照我个人理解就是将音视频数据转化成能够在互联网进行播放的一种流式技术。

## 知识点

### 文件格式

操作系统的扩展名，常用的视频保存格式有：mp4、avi、mpg等

### 封装格式

封装格式（Format），也称多媒体容器（Multimedia Container），是将已编码压缩好的视频轨道、音频轨道和元数据（视频基本信息如标题、字幕等）按照一定的格式规范，打包放到一个文件中，形成特定文件格式的视频文件。

### 编解码

硬编解码：通过硬件实现编解码，减轻CPU计算的负担，如GPU等

软编解码：如 H264、H265、MPEG-4等编解码算法，更消耗CPU


### 编码格式

视频编码方式将视频数据进行压缩或者解压。一般来说压缩技术都会有损数据的

视频编码格式：
1. H.26X系列：
    -   H261：主要在老的视频会议和视频电话产品中使用。
    -   H263：主要用在视频会议、视频电话和网络视频上。
    -   H264：视频压缩技术，比较普及和广发使用，在媒体项目中也是会经常接触，目前市面上多数的流媒体服务都支持H264编码的视频
    -   H265：高效视频压缩技术，同比H264来说压缩效率提高了50%（同画面质量的情况下），而且还支持4K/8K的视频效果，未来会是趋势。但是目前市面上普遍的播放器支持度并不高，flv协议则不支持H265的格式编码的视频。
1. MPEG系列
    - MPEG-1第二部分：主要使用在VCD上，有些在线视频也使用这种格式，该编解码器的质量大致上和原有的VHS录像带相当。
    - MPEG-2第二部分：等同于H.262，使用在DVD、SVCD和大多数数字视频广播系统和有线分布系统（Cable Distribution Systems）中。
    - MPEG-4第二部分：可以使用在网络传输、广播和媒体存储上，比起MPEG-2和第一版的H.263，它的压缩性能有所提高。
    -   MPEG-4第十部分：技术上和ITU-TH.264是相同的标准，二者合作，诞生了H.264/AVC标准，ITU-T将其命名为H.264，而ISO/IEC称它为MPEG-4高级视频编码（Advanced Video Coding，AVC）。
1. AVS：我国自主知识产权的信源编码标准

音频编码格式：
1. AAC：ACC是MPEG-4中的音频标准（常见）
1. AMR
1. PCM
1. ogg(ogg vorbis音频)
1. AC3(DVD 专用音频编码)
1. DTS(DVD 专用音频编码)
1. APE(monkey’s 音频)
1. AU(sun 格式)
1. WMA


音频编码方案之间音质比较（AAC，MP3，WMA等）结果： AAC+ > MP3PRO > AAC> RealAudio > WMA > MP3

### 转码

视频转码（Video Transcoding）是指将已经压缩编码的视频码流转换成另一个视频码流

### 转封装

转封装指的是将视频或音频的封装格式进行转换，如将AVI的视频转换为MP4，其间并不会进行音视频的编码和解码工作，而是直接将视频和音频压缩码流从一种封装格式文件中获取出来然后打包成另一种封装格式的文件。相比转码，转封装有两大特点：

    处理速度极快。音视频编解码过程十分复杂，占据了转码的绝大部分时间。转封装不需要进行编码和解码，节约了大量的处理时间。

    音视频质量无损。没有解码（解压缩）和编码（压缩）过程，所以不会有音视频的压缩损伤。
转封装后的文件与原始文件的分辨率、码率等几乎一致，故播放时也称其为“原画”。

### 码流与码率
码率（Bitrate）是指视频文件在单位时间内使用的数据流量，也叫码流或码流率，是视频编码中画面质量控制最重要的部分。量度单位为“比特每秒”（bit/s或bps），常使用Kbps（每秒多少千个比特）或Mbps。一般来说同样分辨率下，视频文件的码率越大，压缩比就越小，画面质量就越高。码率越大，说明单位时间内取样率越大，数据流精度就越高，处理出来的文件就越接近原始文件，图像质量越好，画质越清晰，要求播放设备的解码能力也越高。

    当然，码率越大，文件体积也越大，其计算公式是文件体积=时间X码率/8。例如，网络上常见的一部60分钟的码率为1Mbps的720P的视频文件，其体积就大概为3600秒×1Mb/8=450MB。
    
### 分辨率

视频分辨率是指视频成像产品所成图像的大小或尺寸。分辨率决定了视频画面细节的精细程度。通常情况下，视频的分辨率越高，所包含的像素就越多，画面就越清晰。

480P : 640 x 480 个像素点

720P : 1280 x 720 个像素点

1080P : 1920 x 1080 个像素点

    分辨率是决定码率的主要因素，不同的分辨率要采用不同的码率。总体而言，视频的分辨率越高，所要求的码率也越大，但并不总是如此，不同分辨率都有合理的码率选择范围。
    所谓“合理的范围”指的是，如果低于这个范围，视频画面质量会很差；如果高于这个范围，画面提升有限甚至几乎无提升，且浪费网络流量和存储空间。 


### 帧率
帧率（Frame Rate）是单位时间内视频显示帧数的量度单位，也就是每秒钟刷新的图片的帧数，量度单位为“每秒显示帧数”（Frame Per Second，FPS）或“赫兹”

关于帧率有如下几个基础数据：

- 帧率越高，cpu消耗就高
- 秀场视频直播，一般帧率20fps
- 普通视频直播，一般帧率15fps


### GOP（关键帧间隔）

GOP（Group of Pictures）是一组以 MPEG 编码的影片或视讯串流内部的连续图像，以 I 帧开头，到下一个 I 帧结束


- I 帧(Intra Coded Picture)：又称帧内编码帧，为关键帧，是一种自带全部信息的独立帧，无需参考其他图像便可独立进行解码，可以简单理解为一张静态画面。视频序列中的第一个帧始终都是I 帧，每个 GOP 由I 帧开始。
- P 帧(Predictive Coded Picture)：又称帧间预测编码帧，需要参考前面的I帧才能进行编码。表示的是当前帧画面与前一帧（前一帧可能是I帧也可能是P帧）的差别。解码时需要用之前缓存的画面叠加上本帧定义的差别，生成最终画面。与I帧相比，P帧通常占用更少的数据位，但不足是，由于P帧对前面的P和I参考帧有着复杂的依赖性，因此对传输错误非常敏感
- B 帧(Bidirectionally Predictive Coded Pictures)：又称双向预测编码帧，也就是B帧记录的是本帧与前后帧的差别。也就是说要解码B帧，不仅要取得之前的缓存画面，还要解码之后的画面，通过前后画面的与本帧数据的叠加取得最终的画面。B帧压缩率高，但是对解码性能要求较高。

GOP值表示关键帧的间隔(即两个关键帧之间的帧数)，也就是两个IDR帧之间的距离，一个帧组的最大帧数。一般而言，每一秒视频至少需要使用 1 个关键帧。增加关键帧个数可改善视频质量，但会同时增加带宽和网络负载。GOP值（帧数）除以帧率即为时间间隔，如阿里云视频点播默认的GOP值为250帧，帧率为25fps，则时间间隔为10秒。

GOP值需要控制在合理范围，以平衡视频质量、文件大小（网络带宽）和seek效果（拖动、快进的响应速度）等：

```
1.加大GOP值有利于减小视频文件大小，但也不宜设置过大，太大则会导致GOP后部帧的画面失真，影响视频质量。

2.GOP值也是影响视频seek响应速度的关键因素，seek时播放器需要定位到离指定位置最近的前一个关键帧，如果GOP太大意味着距离指定位置可能越远（需要解码的预测帧就越多）、seek响应的时间（缓冲时间）也越长。

3.由于P、B帧的复杂度大于I帧，GOP值过大，过多的P、B帧会影响编码效率，使编码效率降低。

4.但如果设置过小的GOP值，则需要提高视频的输出码率，以确保画面质量不会降低，故会增加网络带宽。
```

### IDR 帧对齐
IDR帧（Instantaneous Decoding Refresh Picture），即时解码刷新帧，是 I 帧的一种。与普通 I 帧的区别在于，一个 IDR 帧之后的所有帧都不能引用该 IDR 帧之前的帧的内容；相反，对于普通的 I 帧，其后的 P 帧和 B 帧可以引用该普通 I 帧之前的其他 I 帧。在编码和解码中为了方便，将首个I帧和其他I帧区别开，称为IDR，这样就方便控制编码和解码流程

### 图像存储格式yuv

YUV格式，与我们熟知的RGB类似，YUV也是一种颜色编码方法。YUV，分为三个分量，“Y”表示明亮度（Luminance或Luma），也就是灰度值；而“U”和“V” 表示的则是色度（Chrominance或Chroma），作用是描述影像色彩及饱和度，用于指定像素的颜色。

YUV与RGB相比：
YUV是利用一个亮度（Y）、两个色差(U,V)来代替传统的RGB三原色来压缩图像。传统的RGB三原色使用红绿蓝三原色表示一个像素，每种原色占用一个字节（8bit），因此一个像素用RGB表示则需要8 * 3=24bit。



## 总结

1.码率与分辨率有关系，分辨率决定码率的主要因素，跟帧率没关，帧率关系着画面流畅度和cpu消耗

2.I帧可以看作一张完整的画面，P帧需要与缓存之前画面生成图像，而B帧则就需要记录前后画面画面生成图像。一般来说网络上的电影都会使用B帧，因为压缩率高，带宽消耗相对比较低。压缩率一般是 I帧（7）< P帧（20） < B帧（50）

3.一般来说，硬编码相比一般性能高，效率高，但移植和实现都比较困难，而软编码则实现简单，但性能相比就低一点。

> PS:
在项目遇到过一次坑就是关于视频YUV的问题，由于海康和大华的颜色编码不是相同，海康设备使用了YV12格式，而大华使用了YUV420格式，但是程序统一使用了YUV420，因此海康的画面出现了色差问题。

# 参考
[音视频&流媒体的原理以及基础入门知识
](https://zhuanlan.zhihu.com/p/232291020)

[基础概念](https://help.aliyun.com/document_detail/99380.html?spm=a2c4g.11186623.6.553.28b0c149c65swI)